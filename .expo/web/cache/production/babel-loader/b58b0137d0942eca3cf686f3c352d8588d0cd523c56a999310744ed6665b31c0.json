{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.appAxios=void 0;var _asyncToGenerator2=_interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));var _axios=_interopRequireDefault(require(\"axios\"));var _config=require(\"./config\");var _authService=require(\"./authService\");var appAxios=exports.appAxios=_axios.default.create({baseURL:_config.BASE_URL,timeout:15000});appAxios.interceptors.request.use(function(config){var token=localStorage.getItem(\"accessToken\");if(token){if(config.headers&&typeof config.headers.set===\"function\"){config.headers.set(\"Authorization\",`Bearer ${token}`);}else{config.headers=Object.assign({},config.headers,{Authorization:`Bearer ${token}`});}}return config;},function(error){return Promise.reject(error);});appAxios.interceptors.response.use(function(response){return response;},function(){var _ref=(0,_asyncToGenerator2.default)(function*(error){var _error$response,_error$response2,_error$response2$data;if(((_error$response=error.response)==null?void 0:_error$response.status)===401){try{var newAccessToken=yield(0,_authService.refresh_tokens)();if(newAccessToken&&error.config){var originalRequest=error.config;if(originalRequest.headers&&typeof originalRequest.headers.set===\"function\"){originalRequest.headers.set(\"Authorization\",`Bearer ${newAccessToken}`);}else{originalRequest.headers=Object.assign({},originalRequest.headers,{Authorization:`Bearer ${newAccessToken}`});}return appAxios(originalRequest);}}catch(err){console.warn(\"Token refresh failed:\",err);}}alert(((_error$response2=error.response)==null?void 0:(_error$response2$data=_error$response2.data)==null?void 0:_error$response2$data.message)||\"Something went wrong\");return Promise.reject(error);});return function(_x){return _ref.apply(this,arguments);};}());","map":{"version":3,"names":["_axios","_interopRequireDefault","require","_config","_authService","appAxios","exports","axios","create","baseURL","BASE_URL","timeout","interceptors","request","use","config","token","localStorage","getItem","headers","set","Object","assign","Authorization","error","Promise","reject","response","_ref","_asyncToGenerator2","default","_error$response","_error$response2","_error$response2$data","status","newAccessToken","refresh_tokens","originalRequest","err","console","warn","alert","data","message","_x","apply","arguments"],"sources":["C:/Users/acer/Desktop/paltanweb/src/service/apilnterceptors.ts"],"sourcesContent":["\r\nimport axios, {\r\n  AxiosError,\r\n  AxiosResponse,\r\n  InternalAxiosRequestConfig,\r\n} from \"axios\";\r\nimport { BASE_URL } from \"./config\";\r\nimport { refresh_tokens } from \"./authService\";\r\n\r\n\r\nexport const appAxios = axios.create({\r\n  baseURL: BASE_URL,\r\n  timeout: 15000,\r\n});\r\n\r\n\r\nappAxios.interceptors.request.use(\r\n  (config: InternalAxiosRequestConfig) => {\r\n    const token = localStorage.getItem(\"accessToken\");\r\n    if (token) {\r\n      if (config.headers && typeof config.headers.set === \"function\") {\r\n        config.headers.set(\"Authorization\", `Bearer ${token}`);\r\n      } else {\r\n        (config.headers as any) = {\r\n          ...config.headers,\r\n          Authorization: `Bearer ${token}`,\r\n        };\r\n      }\r\n    }\r\n    return config;\r\n  },\r\n  (error: AxiosError) => Promise.reject(error)\r\n);\r\n\r\n// Response Interceptor\r\nappAxios.interceptors.response.use(\r\n  (response: AxiosResponse) => response,\r\n  async (error: AxiosError) => {\r\n    if (error.response?.status === 401) {\r\n      try {\r\n        const newAccessToken = await refresh_tokens();\r\n        if (newAccessToken && error.config) {\r\n          const originalRequest = error.config as InternalAxiosRequestConfig;\r\n\r\n          if (originalRequest.headers && typeof originalRequest.headers.set === \"function\") {\r\n            originalRequest.headers.set(\"Authorization\", `Bearer ${newAccessToken}`);\r\n          } else {\r\n            (originalRequest.headers as any) = {\r\n              ...originalRequest.headers,\r\n              Authorization: `Bearer ${newAccessToken}`,\r\n            };\r\n          }\r\n\r\n          return appAxios(originalRequest);\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"Token refresh failed:\", err);\r\n      }\r\n    }\r\n\r\n    alert((error.response?.data as any)?.message || \"Something went wrong\");\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n"],"mappings":"sQACA,IAAAA,MAAA,CAAAC,sBAAA,CAAAC,OAAA,WAKA,IAAAC,OAAA,CAAAD,OAAA,aACA,IAAAE,YAAA,CAAAF,OAAA,kBAGO,GAAM,CAAAG,QAAQ,CAAAC,OAAA,CAAAD,QAAA,CAAGE,cAAK,CAACC,MAAM,CAAC,CACnCC,OAAO,CAAEC,gBAAQ,CACjBC,OAAO,CAAE,KACX,CAAC,CAAC,CAGFN,QAAQ,CAACO,YAAY,CAACC,OAAO,CAACC,GAAG,CAC/B,SAACC,MAAkC,CAAK,CACtC,GAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CACjD,GAAIF,KAAK,CAAE,CACT,GAAID,MAAM,CAACI,OAAO,EAAI,MAAO,CAAAJ,MAAM,CAACI,OAAO,CAACC,GAAG,GAAK,UAAU,CAAE,CAC9DL,MAAM,CAACI,OAAO,CAACC,GAAG,CAAC,eAAe,CAAE,UAAUJ,KAAK,EAAE,CAAC,CACxD,CAAC,IAAM,CACJD,MAAM,CAACI,OAAO,CAAAE,MAAA,CAAAC,MAAA,IACVP,MAAM,CAACI,OAAO,EACjBI,aAAa,CAAE,UAAUP,KAAK,EAAE,EACjC,CACH,CACF,CACA,MAAO,CAAAD,MAAM,CACf,CAAC,CACD,SAACS,KAAiB,QAAK,CAAAC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,EAC9C,CAAC,CAGDnB,QAAQ,CAACO,YAAY,CAACe,QAAQ,CAACb,GAAG,CAChC,SAACa,QAAuB,QAAK,CAAAA,QAAQ,kBAAAC,IAAA,IAAAC,kBAAA,CAAAC,OAAA,EACrC,UAAON,KAAiB,CAAK,KAAAO,eAAA,CAAAC,gBAAA,CAAAC,qBAAA,CAC3B,GAAI,EAAAF,eAAA,CAAAP,KAAK,CAACG,QAAQ,eAAdI,eAAA,CAAgBG,MAAM,IAAK,GAAG,CAAE,CAClC,GAAI,CACF,GAAM,CAAAC,cAAc,MAAS,GAAAC,2BAAc,EAAC,CAAC,CAC7C,GAAID,cAAc,EAAIX,KAAK,CAACT,MAAM,CAAE,CAClC,GAAM,CAAAsB,eAAe,CAAGb,KAAK,CAACT,MAAoC,CAElE,GAAIsB,eAAe,CAAClB,OAAO,EAAI,MAAO,CAAAkB,eAAe,CAAClB,OAAO,CAACC,GAAG,GAAK,UAAU,CAAE,CAChFiB,eAAe,CAAClB,OAAO,CAACC,GAAG,CAAC,eAAe,CAAE,UAAUe,cAAc,EAAE,CAAC,CAC1E,CAAC,IAAM,CACJE,eAAe,CAAClB,OAAO,CAAAE,MAAA,CAAAC,MAAA,IACnBe,eAAe,CAAClB,OAAO,EAC1BI,aAAa,CAAE,UAAUY,cAAc,EAAE,EAC1C,CACH,CAEA,MAAO,CAAA9B,QAAQ,CAACgC,eAAe,CAAC,CAClC,CACF,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAACC,IAAI,CAAC,uBAAuB,CAAEF,GAAG,CAAC,CAC5C,CACF,CAEAG,KAAK,CAAC,EAAAT,gBAAA,CAACR,KAAK,CAACG,QAAQ,gBAAAM,qBAAA,CAAdD,gBAAA,CAAgBU,IAAI,eAArBT,qBAAA,CAA+BU,OAAO,GAAI,sBAAsB,CAAC,CACvE,MAAO,CAAAlB,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAC9B,CAAC,kBAAAoB,EAAA,SAAAhB,IAAA,CAAAiB,KAAA,MAAAC,SAAA,OACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}