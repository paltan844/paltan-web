{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.createTransaction=exports.createOrders=void 0;var _asyncToGenerator2=_interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));var _config=require(\"../../../service/config\");var _NavigationUtils=require(\"../../../utils/NavigationUtils\");var _axios=_interopRequireDefault(require(\"axios\"));var _reactNativeRazorpay=_interopRequireDefault(require(\"react-native-razorpay\"));var _storage=require(\"../../../state/storage\");var _cartStore=require(\"../../../state/cartStore\");var _authStore=require(\"../../../state/authStore\");var token=_storage.tokenStorage.getString('accessToken');var fullName=_storage.mmkvStorage.getItem('userFullName')||'Guest';var phone=_storage.mmkvStorage.getItem('userPhone')||'';var createTransaction=exports.createTransaction=function(){var _ref=(0,_asyncToGenerator2.default)(function*(amount,userId){try{if(!token){return null;}var res=yield _axios.default.post(`${_config.BASE_URL}/order/transaction`,{userId:userId,amount:amount*100},{headers:{Authorization:`Bearer ${token}`}});return res.data;}catch(error){var _error$response;console.error('❌ Error creating transaction:',(error==null?void 0:(_error$response=error.response)==null?void 0:_error$response.data)||error.message);return null;}});return function createTransaction(_x,_x2){return _ref.apply(this,arguments);};}();var createOrders=exports.createOrders=function(){var _ref2=(0,_asyncToGenerator2.default)(function*(key,amount,order_id,cart,userId,address){try{var _orderResponse$data;var options={description:'Ecommerce Shopping',image:'https://i.posting.cc/ZRCCXLgg/temp-Imagef-Coi-ZY.avif',currency:'INR',key:key,amount:amount,name:'Paltan',order_id:order_id,theme:{color:'#F37254'},prefill:{name:fullName,contact:phone}};var data=yield _reactNativeRazorpay.default.open(options);if(!(data!=null&&data.razorpay_payment_id)||!(data!=null&&data.razorpay_signature)){return{type:'error',message:'Invalid Razorpay response'};}var orderResponse=yield _axios.default.post(`${_config.BASE_URL}/orders`,{razorpay_order_id:order_id,razorpay_payment_id:data==null?void 0:data.razorpay_payment_id,razorpay_signature:data==null?void 0:data.razorpay_signature,userId:userId,cartItems:cart,branch:'686e910cba6c97c2a5301768',address:address,deliveryDate:new Date(Date.now()+7*24*60*60*1000)},{headers:{Authorization:`Bearer ${token}`}});var order=(_orderResponse$data=orderResponse.data)==null?void 0:_orderResponse$data.order;if(order){_cartStore.useCartStore.getState().clearCart();_authStore.useAuthStore.getState().setCurrentOrder(order);(0,_NavigationUtils.navigate)('OrderSuccess',{price:amount/100,address:address});return{type:'success',order:order};}else{return{type:'error',message:'Order creation failed'};}}catch(err){console.warn('❌ Payment Cancelled or Failed:',(err==null?void 0:err.description)||(err==null?void 0:err.message));return{type:'error',message:(err==null?void 0:err.description)||'Payment cancelled or failed'};}});return function createOrders(_x3,_x4,_x5,_x6,_x7,_x8){return _ref2.apply(this,arguments);};}();","map":{"version":3,"names":["_config","require","_NavigationUtils","_axios","_interopRequireDefault","_reactNativeRazorpay","_storage","_cartStore","_authStore","token","tokenStorage","getString","fullName","mmkvStorage","getItem","phone","createTransaction","exports","_ref","_asyncToGenerator2","default","amount","userId","res","axios","post","BASE_URL","headers","Authorization","data","error","_error$response","console","response","message","_x","_x2","apply","arguments","createOrders","_ref2","key","order_id","cart","address","_orderResponse$data","options","description","image","currency","name","theme","color","prefill","contact","RazorpayCheckout","open","razorpay_payment_id","razorpay_signature","type","orderResponse","razorpay_order_id","cartItems","branch","deliveryDate","Date","now","order","useCartStore","getState","clearCart","useAuthStore","setCurrentOrder","navigate","price","err","warn","_x3","_x4","_x5","_x6","_x7","_x8"],"sources":["C:/Users/acer/Desktop/paltanweb/src/features/cart/api/paygateway.tsx"],"sourcesContent":["import { BASE_URL } from '@service/config';\r\nimport { navigate } from '@utils/NavigationUtils';\r\nimport axios from 'axios';\r\nimport RazorpayCheckout from 'react-native-razorpay';\r\nimport { mmkvStorage, tokenStorage } from '@state/storage';\r\nimport { useCartStore } from '@state/cartStore';\r\nimport { useAuthStore } from '@state/authStore';\r\n\r\nconst token = tokenStorage.getString('accessToken');\r\n\r\nconst fullName = mmkvStorage.getItem('userFullName') || 'Guest';\r\nconst phone = mmkvStorage.getItem('userPhone') || '';\r\n\r\nexport const createTransaction = async (amount: number, userId: string) => {\r\n\r\n  try {\r\n    if (!token) {\r\n      return null;\r\n    }\r\n\r\n    const res = await axios.post(\r\n      `${BASE_URL}/order/transaction`,\r\n      {\r\n        userId,\r\n        amount: amount * 100,\r\n      },\r\n      {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error('❌ Error creating transaction:', error?.response?.data || error.message);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const createOrders = async (\r\n  key: string,\r\n  amount: number,\r\n  order_id: string,\r\n  cart: any,\r\n  userId: string,\r\n  address: Record<string, any>\r\n\r\n) => {\r\n  try {\r\n    const options = {\r\n      description: 'Ecommerce Shopping',\r\n      image: 'https://i.posting.cc/ZRCCXLgg/temp-Imagef-Coi-ZY.avif',\r\n      currency: 'INR',\r\n      key: key,\r\n      amount: amount,\r\n      name: 'Paltan',\r\n      order_id: order_id,\r\n      theme: { color: '#F37254' },\r\n      prefill: {\r\n        name: fullName,\r\n        contact: phone,\r\n      },\r\n    };\r\n\r\n    const data = await RazorpayCheckout.open(options);\r\n\r\n    if (!data?.razorpay_payment_id || !data?.razorpay_signature) {\r\n      return { type: 'error', message: 'Invalid Razorpay response' };\r\n    }\r\n\r\n    const orderResponse = await axios.post(`${BASE_URL}/orders`, {\r\n      razorpay_order_id: order_id,\r\n      razorpay_payment_id: data?.razorpay_payment_id,\r\n      razorpay_signature: data?.razorpay_signature,\r\n      userId: userId,\r\n      cartItems: cart,\r\n      branch: '686e910cba6c97c2a5301768',\r\n      address: address,\r\n      deliveryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\r\n    },\r\n   {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  }\r\n  );\r\n\r\n    const order = orderResponse.data?.order;\r\n\r\n    if (order) {\r\n      useCartStore.getState().clearCart();\r\n      useAuthStore.getState().setCurrentOrder(order);\r\n      navigate('OrderSuccess', {\r\n        price: amount / 100,\r\n        address: address,\r\n      });\r\n      return { type: 'success', order };\r\n    } else {\r\n      return { type: 'error', message: 'Order creation failed' };\r\n    }\r\n  } catch (err: any) {\r\n    console.warn('❌ Payment Cancelled or Failed:', err?.description || err?.message);\r\n    return { type: 'error', message: err?.description || 'Payment cancelled or failed' };\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}