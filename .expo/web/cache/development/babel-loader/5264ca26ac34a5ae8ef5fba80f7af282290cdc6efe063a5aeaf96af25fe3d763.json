{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createTransaction = exports.createOrders = void 0;\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _config = require(\"../../../service/config\");\nvar _NavigationUtils = require(\"../../../utils/NavigationUtils\");\nvar _axios = _interopRequireDefault(require(\"axios\"));\nvar _reactNativeRazorpay = _interopRequireDefault(require(\"react-native-razorpay\"));\nvar _storage = require(\"../../../state/storage\");\nvar _cartStore = require(\"../../../state/cartStore\");\nvar _authStore = require(\"../../../state/authStore\");\nvar token = _storage.tokenStorage.getString('accessToken');\nvar fullName = _storage.mmkvStorage.getItem('userFullName') || 'Guest';\nvar phone = _storage.mmkvStorage.getItem('userPhone') || '';\nvar createTransaction = exports.createTransaction = function () {\n  var _ref = (0, _asyncToGenerator2.default)(function* (amount, userId) {\n    try {\n      if (!token) {\n        return null;\n      }\n      var res = yield _axios.default.post(`${_config.BASE_URL}/order/transaction`, {\n        userId: userId,\n        amount: amount * 100\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      return res.data;\n    } catch (error) {\n      var _error$response;\n      console.error('❌ Error creating transaction:', (error == null ? void 0 : (_error$response = error.response) == null ? void 0 : _error$response.data) || error.message);\n      return null;\n    }\n  });\n  return function createTransaction(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar createOrders = exports.createOrders = function () {\n  var _ref2 = (0, _asyncToGenerator2.default)(function* (key, amount, order_id, cart, userId, address) {\n    try {\n      var _orderResponse$data;\n      var options = {\n        description: 'Ecommerce Shopping',\n        image: 'https://i.posting.cc/ZRCCXLgg/temp-Imagef-Coi-ZY.avif',\n        currency: 'INR',\n        key: key,\n        amount: amount,\n        name: 'Paltan',\n        order_id: order_id,\n        theme: {\n          color: '#F37254'\n        },\n        prefill: {\n          name: fullName,\n          contact: phone\n        }\n      };\n      var data = yield _reactNativeRazorpay.default.open(options);\n      if (!(data != null && data.razorpay_payment_id) || !(data != null && data.razorpay_signature)) {\n        return {\n          type: 'error',\n          message: 'Invalid Razorpay response'\n        };\n      }\n      var orderResponse = yield _axios.default.post(`${_config.BASE_URL}/orders`, {\n        razorpay_order_id: order_id,\n        razorpay_payment_id: data == null ? void 0 : data.razorpay_payment_id,\n        razorpay_signature: data == null ? void 0 : data.razorpay_signature,\n        userId: userId,\n        cartItems: cart,\n        branch: '686e910cba6c97c2a5301768',\n        address: address,\n        deliveryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      var order = (_orderResponse$data = orderResponse.data) == null ? void 0 : _orderResponse$data.order;\n      if (order) {\n        _cartStore.useCartStore.getState().clearCart();\n        _authStore.useAuthStore.getState().setCurrentOrder(order);\n        (0, _NavigationUtils.navigate)('OrderSuccess', {\n          price: amount / 100,\n          address: address\n        });\n        return {\n          type: 'success',\n          order: order\n        };\n      } else {\n        return {\n          type: 'error',\n          message: 'Order creation failed'\n        };\n      }\n    } catch (err) {\n      console.warn('❌ Payment Cancelled or Failed:', (err == null ? void 0 : err.description) || (err == null ? void 0 : err.message));\n      return {\n        type: 'error',\n        message: (err == null ? void 0 : err.description) || 'Payment cancelled or failed'\n      };\n    }\n  });\n  return function createOrders(_x3, _x4, _x5, _x6, _x7, _x8) {\n    return _ref2.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["_config","require","_NavigationUtils","_axios","_interopRequireDefault","_reactNativeRazorpay","_storage","_cartStore","_authStore","token","tokenStorage","getString","fullName","mmkvStorage","getItem","phone","createTransaction","exports","_ref","_asyncToGenerator2","default","amount","userId","res","axios","post","BASE_URL","headers","Authorization","data","error","_error$response","console","response","message","_x","_x2","apply","arguments","createOrders","_ref2","key","order_id","cart","address","_orderResponse$data","options","description","image","currency","name","theme","color","prefill","contact","RazorpayCheckout","open","razorpay_payment_id","razorpay_signature","type","orderResponse","razorpay_order_id","cartItems","branch","deliveryDate","Date","now","order","useCartStore","getState","clearCart","useAuthStore","setCurrentOrder","navigate","price","err","warn","_x3","_x4","_x5","_x6","_x7","_x8"],"sources":["C:/Users/acer/Desktop/paltanweb/src/features/cart/api/paygateway.tsx"],"sourcesContent":["import { BASE_URL } from '@service/config';\r\nimport { navigate } from '@utils/NavigationUtils';\r\nimport axios from 'axios';\r\nimport RazorpayCheckout from 'react-native-razorpay';\r\nimport { mmkvStorage, tokenStorage } from '@state/storage';\r\nimport { useCartStore } from '@state/cartStore';\r\nimport { useAuthStore } from '@state/authStore';\r\n\r\nconst token = tokenStorage.getString('accessToken');\r\n\r\nconst fullName = mmkvStorage.getItem('userFullName') || 'Guest';\r\nconst phone = mmkvStorage.getItem('userPhone') || '';\r\n\r\nexport const createTransaction = async (amount: number, userId: string) => {\r\n\r\n  try {\r\n    if (!token) {\r\n      return null;\r\n    }\r\n\r\n    const res = await axios.post(\r\n      `${BASE_URL}/order/transaction`,\r\n      {\r\n        userId,\r\n        amount: amount * 100,\r\n      },\r\n      {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error('❌ Error creating transaction:', error?.response?.data || error.message);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const createOrders = async (\r\n  key: string,\r\n  amount: number,\r\n  order_id: string,\r\n  cart: any,\r\n  userId: string,\r\n  address: Record<string, any>\r\n\r\n) => {\r\n  try {\r\n    const options = {\r\n      description: 'Ecommerce Shopping',\r\n      image: 'https://i.posting.cc/ZRCCXLgg/temp-Imagef-Coi-ZY.avif',\r\n      currency: 'INR',\r\n      key: key,\r\n      amount: amount,\r\n      name: 'Paltan',\r\n      order_id: order_id,\r\n      theme: { color: '#F37254' },\r\n      prefill: {\r\n        name: fullName,\r\n        contact: phone,\r\n      },\r\n    };\r\n\r\n    const data = await RazorpayCheckout.open(options);\r\n\r\n    if (!data?.razorpay_payment_id || !data?.razorpay_signature) {\r\n      return { type: 'error', message: 'Invalid Razorpay response' };\r\n    }\r\n\r\n    const orderResponse = await axios.post(`${BASE_URL}/orders`, {\r\n      razorpay_order_id: order_id,\r\n      razorpay_payment_id: data?.razorpay_payment_id,\r\n      razorpay_signature: data?.razorpay_signature,\r\n      userId: userId,\r\n      cartItems: cart,\r\n      branch: '686e910cba6c97c2a5301768',\r\n      address: address,\r\n      deliveryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\r\n    },\r\n   {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  }\r\n  );\r\n\r\n    const order = orderResponse.data?.order;\r\n\r\n    if (order) {\r\n      useCartStore.getState().clearCart();\r\n      useAuthStore.getState().setCurrentOrder(order);\r\n      navigate('OrderSuccess', {\r\n        price: amount / 100,\r\n        address: address,\r\n      });\r\n      return { type: 'success', order };\r\n    } else {\r\n      return { type: 'error', message: 'Order creation failed' };\r\n    }\r\n  } catch (err: any) {\r\n    console.warn('❌ Payment Cancelled or Failed:', err?.description || err?.message);\r\n    return { type: 'error', message: err?.description || 'Payment cancelled or failed' };\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}