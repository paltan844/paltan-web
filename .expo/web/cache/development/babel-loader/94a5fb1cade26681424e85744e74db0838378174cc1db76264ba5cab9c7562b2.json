{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.appAxios = void 0;\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _axios = _interopRequireDefault(require(\"axios\"));\nvar _config = require(\"./config\");\nvar _authService = require(\"./authService\");\nvar appAxios = exports.appAxios = _axios.default.create({\n  baseURL: _config.BASE_URL,\n  timeout: 15000\n});\nappAxios.interceptors.request.use(function (config) {\n  var token = localStorage.getItem(\"accessToken\");\n  if (token) {\n    if (config.headers && typeof config.headers.set === \"function\") {\n      config.headers.set(\"Authorization\", `Bearer ${token}`);\n    } else {\n      config.headers = Object.assign({}, config.headers, {\n        Authorization: `Bearer ${token}`\n      });\n    }\n  }\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\nappAxios.interceptors.response.use(function (response) {\n  return response;\n}, function () {\n  var _ref = (0, _asyncToGenerator2.default)(function* (error) {\n    var _error$response, _error$response2, _error$response2$data;\n    if (((_error$response = error.response) == null ? void 0 : _error$response.status) === 401) {\n      try {\n        var newAccessToken = yield (0, _authService.refresh_tokens)();\n        if (newAccessToken && error.config) {\n          var originalRequest = error.config;\n          if (originalRequest.headers && typeof originalRequest.headers.set === \"function\") {\n            originalRequest.headers.set(\"Authorization\", `Bearer ${newAccessToken}`);\n          } else {\n            originalRequest.headers = Object.assign({}, originalRequest.headers, {\n              Authorization: `Bearer ${newAccessToken}`\n            });\n          }\n          return appAxios(originalRequest);\n        }\n      } catch (err) {\n        console.warn(\"Token refresh failed:\", err);\n      }\n    }\n    alert(((_error$response2 = error.response) == null ? void 0 : (_error$response2$data = _error$response2.data) == null ? void 0 : _error$response2$data.message) || \"Something went wrong\");\n    return Promise.reject(error);\n  });\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}());","map":{"version":3,"names":["_axios","_interopRequireDefault","require","_config","_authService","appAxios","exports","axios","create","baseURL","BASE_URL","timeout","interceptors","request","use","config","token","localStorage","getItem","headers","set","Object","assign","Authorization","error","Promise","reject","response","_ref","_asyncToGenerator2","default","_error$response","_error$response2","_error$response2$data","status","newAccessToken","refresh_tokens","originalRequest","err","console","warn","alert","data","message","_x","apply","arguments"],"sources":["C:/Users/acer/Desktop/paltanweb/src/service/apilnterceptors.ts"],"sourcesContent":["\r\nimport axios, {\r\n  AxiosError,\r\n  AxiosResponse,\r\n  InternalAxiosRequestConfig,\r\n} from \"axios\";\r\nimport { BASE_URL } from \"./config\";\r\nimport { refresh_tokens } from \"./authService\";\r\n\r\n\r\nexport const appAxios = axios.create({\r\n  baseURL: BASE_URL,\r\n  timeout: 15000,\r\n});\r\n\r\n\r\nappAxios.interceptors.request.use(\r\n  (config: InternalAxiosRequestConfig) => {\r\n    const token = localStorage.getItem(\"accessToken\");\r\n    if (token) {\r\n      if (config.headers && typeof config.headers.set === \"function\") {\r\n        config.headers.set(\"Authorization\", `Bearer ${token}`);\r\n      } else {\r\n        (config.headers as any) = {\r\n          ...config.headers,\r\n          Authorization: `Bearer ${token}`,\r\n        };\r\n      }\r\n    }\r\n    return config;\r\n  },\r\n  (error: AxiosError) => Promise.reject(error)\r\n);\r\n\r\n// Response Interceptor\r\nappAxios.interceptors.response.use(\r\n  (response: AxiosResponse) => response,\r\n  async (error: AxiosError) => {\r\n    if (error.response?.status === 401) {\r\n      try {\r\n        const newAccessToken = await refresh_tokens();\r\n        if (newAccessToken && error.config) {\r\n          const originalRequest = error.config as InternalAxiosRequestConfig;\r\n\r\n          if (originalRequest.headers && typeof originalRequest.headers.set === \"function\") {\r\n            originalRequest.headers.set(\"Authorization\", `Bearer ${newAccessToken}`);\r\n          } else {\r\n            (originalRequest.headers as any) = {\r\n              ...originalRequest.headers,\r\n              Authorization: `Bearer ${newAccessToken}`,\r\n            };\r\n          }\r\n\r\n          return appAxios(originalRequest);\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"Token refresh failed:\", err);\r\n      }\r\n    }\r\n\r\n    alert((error.response?.data as any)?.message || \"Something went wrong\");\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n"],"mappings":";;;;;;AACA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AAKA,IAAAC,OAAA,GAAAD,OAAA;AACA,IAAAE,YAAA,GAAAF,OAAA;AAGO,IAAMG,QAAQ,GAAAC,OAAA,CAAAD,QAAA,GAAGE,cAAK,CAACC,MAAM,CAAC;EACnCC,OAAO,EAAEC,gBAAQ;EACjBC,OAAO,EAAE;AACX,CAAC,CAAC;AAGFN,QAAQ,CAACO,YAAY,CAACC,OAAO,CAACC,GAAG,CAC/B,UAACC,MAAkC,EAAK;EACtC,IAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EACjD,IAAIF,KAAK,EAAE;IACT,IAAID,MAAM,CAACI,OAAO,IAAI,OAAOJ,MAAM,CAACI,OAAO,CAACC,GAAG,KAAK,UAAU,EAAE;MAC9DL,MAAM,CAACI,OAAO,CAACC,GAAG,CAAC,eAAe,EAAE,UAAUJ,KAAK,EAAE,CAAC;IACxD,CAAC,MAAM;MACJD,MAAM,CAACI,OAAO,GAAAE,MAAA,CAAAC,MAAA,KACVP,MAAM,CAACI,OAAO;QACjBI,aAAa,EAAE,UAAUP,KAAK;MAAE,EACjC;IACH;EACF;EACA,OAAOD,MAAM;AACf,CAAC,EACD,UAACS,KAAiB;EAAA,OAAKC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAAA,CAC9C,CAAC;AAGDnB,QAAQ,CAACO,YAAY,CAACe,QAAQ,CAACb,GAAG,CAChC,UAACa,QAAuB;EAAA,OAAKA,QAAQ;AAAA;EAAA,IAAAC,IAAA,OAAAC,kBAAA,CAAAC,OAAA,EACrC,WAAON,KAAiB,EAAK;IAAA,IAAAO,eAAA,EAAAC,gBAAA,EAAAC,qBAAA;IAC3B,IAAI,EAAAF,eAAA,GAAAP,KAAK,CAACG,QAAQ,qBAAdI,eAAA,CAAgBG,MAAM,MAAK,GAAG,EAAE;MAClC,IAAI;QACF,IAAMC,cAAc,SAAS,IAAAC,2BAAc,EAAC,CAAC;QAC7C,IAAID,cAAc,IAAIX,KAAK,CAACT,MAAM,EAAE;UAClC,IAAMsB,eAAe,GAAGb,KAAK,CAACT,MAAoC;UAElE,IAAIsB,eAAe,CAAClB,OAAO,IAAI,OAAOkB,eAAe,CAAClB,OAAO,CAACC,GAAG,KAAK,UAAU,EAAE;YAChFiB,eAAe,CAAClB,OAAO,CAACC,GAAG,CAAC,eAAe,EAAE,UAAUe,cAAc,EAAE,CAAC;UAC1E,CAAC,MAAM;YACJE,eAAe,CAAClB,OAAO,GAAAE,MAAA,CAAAC,MAAA,KACnBe,eAAe,CAAClB,OAAO;cAC1BI,aAAa,EAAE,UAAUY,cAAc;YAAE,EAC1C;UACH;UAEA,OAAO9B,QAAQ,CAACgC,eAAe,CAAC;QAClC;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,IAAI,CAAC,uBAAuB,EAAEF,GAAG,CAAC;MAC5C;IACF;IAEAG,KAAK,CAAC,EAAAT,gBAAA,GAACR,KAAK,CAACG,QAAQ,sBAAAM,qBAAA,GAAdD,gBAAA,CAAgBU,IAAI,qBAArBT,qBAAA,CAA+BU,OAAO,KAAI,sBAAsB,CAAC;IACvE,OAAOlB,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;EAC9B,CAAC;EAAA,iBAAAoB,EAAA;IAAA,OAAAhB,IAAA,CAAAiB,KAAA,OAAAC,SAAA;EAAA;AAAA,GACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}